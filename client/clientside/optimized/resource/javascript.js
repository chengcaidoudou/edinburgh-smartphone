var stockSymbols=["BMO","AAPL","MSFT","GOOG","ORCL","YHOO"];var benchmarks=["^IXIC","^NDX"];$.datepicker.setDefaults({dateFormat:"yy-mm-dd",autoSize:true});$(function(){$(".date").datepicker()});$(function(){$(".symbol").autocomplete({source:stockSymbols});$("#benchmark").autocomplete({source:benchmarks})});$(function(){$("#ssd button").click(function(){handleButtonAction("ssd",$(this).attr("action"))});$("#mad button").click(function(){handleButtonAction("mad",$(this).attr("action"))})});$(function(){$("#sections").accordion({autoHeight:false})});$(function(){$("#all").tabs()});$(function(){$("#dialog").dialog({position:[5,80],modal:true,autoResize:true,autoOpen:false});$("#dialog").hide()});function handleButtonAction(a,c){logDebug("button pressed - type["+a+"] action["+c+"]");if(c=="add"){addSymbol(a);$("#"+a+' button[action="del"]').attr("disabled",false);$("#"+a+' button[action="solve"]').attr("disabled",false)}else{if(c=="del"){delSymbol(a);var b=$("#symbolset_"+a+" input");if(b.length==0){logDebug("diabling the button --#"+a+' button[action="del"]');$("#"+a+' button[action="del"]').attr("disabled",true);$("#"+a+' button[action="solve"]').attr("disabled",true)}}else{if(c=="solve"&&(a=="ssd"||a=="mad")){if(validateInput(a)){solveProblem(a);$("#all").mask("Communicating with web service...");$("#"+a+' button[action="solve"]').attr("disabled",true)}}}}}function validateInput(a){var b=$("#symbolset_"+a+" input");for(i=0;i<b.length;i++){if(b[i].value==""){displayDialogMsg("Invalid user input!","All stock symbols should be filled.");return false}}var c=$("#"+a+" .date");for(i=0;i<c.length;i++){if(c[i].value==""){displayDialogMsg("Invalid user input!","Please input date range.");return false}}return true}function solveProblem(a){if(a=="mad"){invokeOptimizePortfolioMAD()}else{if(a=="ssd"){invokeOptimizePortfolioSSD()}}}function invokeOptimizePortfolioSSD(){document.getElementById("result_area_ssd").value="";logDebug("invokeOptimizePortfolioSSD");var j=new AX21_SymbolSet();var d=document.getElementById("symbolset_ssd");var f=d.getElementsByTagName("input");var e=0;var b=new Array();for(e=0;e<f.length;e++){b[e]=f[e].value;logDebug("add symbol: "+b[e])}j.setSymbols(b);var g=document.getElementById("benchmark").value;logDebug("benchmark : "+g);var h=document.getElementById("startdate_ssd").value+"T00:00:00";logDebug("start date: "+h);var c=document.getElementById("enddate_ssd").value+"T00:00:00";logDebug("end date: "+c);var a=new uk_ac_ed_maths_org_AlmPortType();a.url="/axis2/services/Alm";logDebug("calling web service at ===> "+a.url);a.optimizePortfolioSSD(optimizePortfolioSSDResponse,optimizePortfolioSSDError,j,g,h,c)}function invokeOptimizePortfolioMAD(){document.getElementById("result_area_mad").value="";logDebug("invokeOptimizePortfolioMAD");var j=new AX21_SymbolSet();var d=document.getElementById("symbolset_mad");var f=d.getElementsByTagName("input");var e=0;var b=new Array();for(e=0;e<f.length;e++){b[e]=f[e].value;logDebug("add symbol: "+b[e])}j.setSymbols(b);var h=document.getElementById("returnRatio").value;logDebug("returnRatio : "+h);var g=document.getElementById("startdate_mad").value+"T00:00:00";logDebug("start date: "+g);var c=document.getElementById("enddate_mad").value+"T00:00:00";logDebug("end date: "+c);var a=new uk_ac_ed_maths_org_AlmPortType();a.url="/axis2/services/Alm";logDebug("calling web service at ===> "+a.url);a.optimizePortfolioMAD(optimizePortfolioMADResponse,optimizePortfolioMADError,j,h,g,c)}function optimizePortfolioMADResponse(c){logResponseXML(c);var g=document.getElementById("result_area_mad");var a=c.getReturn();if(a.getResultCode()==0){var h=a.getExpReturn();var e=a.getPortfolioRatio();var j="The minimial risk is "+h+"\n";j+="Asset allocation: \n";var b=document.getElementById("symbolset_mad");var f=b.getElementsByTagName("input");var d=0;for(d=0;d<f.length;d++){j+=f[d].value+" : "+e[d]+"\n"}g.value=j.toString()}else{if(a.getResultCode()==1){g.value="Problem Infeasible or Unbounded!"}else{if(a.getResultCode()==2){g.value="Excess Solver's Iteration Limit!"}else{if(ssdReturn.getResultCode()==3){g.value="Data retrieval error! Data points doesn't match."}}}}handleCallback("mad")}function optimizePortfolioSSDResponse(b){logResponseXML(b);var g=document.getElementById("result_area_ssd");var f=b.getReturn();if(f.getResultCode()==0){var h=f.getExpReturn();var d=f.getPortfolioRatio();var j="The expected Return is "+h+"\n";j+="Asset allocation: \n";var a=document.getElementById("symbolset_ssd");var e=a.getElementsByTagName("input");var c=0;for(c=0;c<e.length;c++){j+=e[c].value+" : "+d[c]+"\n"}g.value=j.toString()}else{if(f.getResultCode()==1){g.value="Problem Infeasible or Unbounded!"}else{if(f.getResultCode()==2){g.value="Excess Solver's Iteration Limit!"}else{if(f.getResultCode()==3){g.value="Data retrieval error! Data points doesn't match."}}}}handleCallback("ssd")}function optimizePortfolioMADError(a){handleWebServiceError("mad",a)}function optimizePortfolioSSDError(a){handleWebServiceError("ssd",a)}function handleWebServiceError(b,a){displayDialogMsg("Serverside Error","Axis2 service not aviable");handleCallback(b)}function handleCallback(a){$("#all").unmask();$("#"+a+' button[action="solve"]').attr("disabled",false)}function displayDialogMsg(b,a){$("#dialog").dialog("option","title",b);$("#dialog p").html(a);$("#dialog").show().dialog("open")}function addSymbol(c){logDebug("addSymbol --type["+c+"]");var b=document.createElement("input");b.setAttribute("type","text");b.setAttribute("value","");b.setAttribute("class","symbol");b.setAttribute("maxlength",8);b.setAttribute("size",8);$(b).autocomplete({source:stockSymbols});var a=document.getElementById("symbolset_"+c);a.appendChild(b)}function delSymbol(b){var a=document.getElementById("symbolset_"+b);var c=a.getElementsByTagName("input");a.removeChild(c[c.length-1])}function logResponseXML(b){var a=new CxfApacheOrgUtil();var d=b.getReturn();var c=d.serialize(a,d,null);logDebug(c)}function logDebug(a){document.getElementById("debug_area").value+=a+"\n";document.getElementById("debug_area").scrollTop=document.getElementById("debug_area").scrollHeight};